from GUI import GUI
from HAL import HAL
import cv2

# Initialize GUI and HAL
gui = GUI()
hal = HAL()

# Coordinates of the safety boat and known survivor location
safety_boat_location = (40.280061, -3.817639)  # 40º16’48.2” N, 3º49’03.5” W
survivor_location = (40.279786, -3.817161)  # 40º16’47.23” N, 3º49’01.78” W

# Main loop
while True:
    # Capture image from the quadrotor's camera
    image = hal.get_camera_image()

    # Use OpenCV for face detection (you may need to install OpenCV)
    faces = cv2.detect_faces(image)

    # Check if faces are detected
    if faces:
        for face in faces:
            # Extract face coordinates
            x, y, w, h = face['coordinates']

            # Calculate the center of the detected face
            face_center_x = x + w // 2
            face_center_y = y + h // 2

            # Display the detected face on the GUI
            gui.show_detected_face(image, (face_center_x, face_center_y))

            # Calculate the GPS coordinates of the detected face
            # You may need to calibrate this based on the camera's orientation
            face_gps_location = calculate_gps_location(face_center_x, face_center_y)

            # Save the GPS location of the detected face for rescue maneuver
            hal.save_survivor_location(face_gps_location)

    # Perform subsequent rescue maneuver based on saved locations
    hal.perform_rescue_maneuver()




######################################



from GUI import GUI
from HAL import HAL

victims_x = 30
victims_y = -40
boat_x = 0
boat_y = 0

x_vel = 0.25
angle = 0.6
iterations = 0
spiral_iterations = 300
landing_margin = 0.07

x_pos = HAL.get_position()[0]
y_pos = HAL.get_position()[1]

HAL.takeoff(3)

while not ((victims_x-1 < x_pos) and (x_pos <victims_x+1) and (victims_y-1 < y_pos) and (y_pos < victims_y+1)):
	GUI.showImage(HAL.get_frontal_image())
	GUI.showLeftImage(HAL.get_ventral_image())
	x_pos = HAL.get_position()[0]
	y_pos = HAL.get_position()[1]
	HAL.set_cmd_pos(victims_x, victims_y, 3, angle)
	# time.sleep(0.01)
	
while True:
	# Enter iterative code!
	GUI.showImage(HAL.get_frontal_image())
	GUI.showLeftImage(HAL.get_ventral_image())
